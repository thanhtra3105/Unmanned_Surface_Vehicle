<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>USV Dashboard</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; text-align: center; }
    .telemetry { margin: 10px; font-size: 18px; }
    button { margin: 5px; padding: 10px 20px; border: none; border-radius: 8px; background: #28a745; color: white; }
    button.stop { background: #dc3545; }
  </style>
</head>
<body>
  <h1>🌊 USV MQTT Dashboard</h1>
  <div class="telemetry" id="telemetry">Đang chờ dữ liệu...</div>

  <div>
    <button onclick="sendCommand('usv/command/arm', '1')">ARM</button>
    <button onclick="sendCommand('usv/command/arm', '0')" class="stop">DISARM</button>
    <button onclick="sendCommand('usv/command/mode', 'AUTO')">AUTO</button>
    <button onclick="sendCommand('usv/command/mode', 'MANUAL')">MANUAL</button>
  </div>

  <script>
    const client = mqtt.connect("wss://broker.emqx.io:8084/mqtt");

    client.on("connect", () => {
      console.log("✅ Connected to MQTT Broker");
      client.subscribe("usv/telemetry");
    });

    client.on("message", (topic, message) => {
      if (topic === "usv/telemetry") {
        const data = JSON.parse(message.toString());
        document.getElementById("telemetry").innerHTML = `
          📡 Battery: ${data.battery}% <br>
          💨 Speed: ${data.speed} m/s <br>
          🧭 Heading: ${data.heading}° <br>
          🌡️ pH: ${data.ph ?? 'N/A'} <br>
          📍 Lat: ${data.lat}, Lon: ${data.lon}
        `;
      }
    });

    function sendCommand(topic, msg) {
      client.publish(topic, msg);
      console.log("📤 Sent:", topic, msg);
    }
  </script>
</body>
</html>
